!function(e,t){"function"==typeof define&&define.amd&&define([],t),e.glympse||(e.glympse={}),e.glympse.GlympseAdapter=t()}(this,function(){function e(){}var t,n,r;return function(e){function i(e,t){return w.call(e,t)}function o(e,t){var n,r,i,o,a,s,u,c,l,d,f,p=t&&t.split("/"),h=y.map,g=h&&h["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=e.split("/"),a=e.length-1,y.nodeIdCompat&&E.test(e[a])&&(e[a]=e[a].replace(E,"")),e=p.slice(0,p.length-1).concat(e),l=0;l<e.length;l+=1)if(f=e[l],"."===f)e.splice(l,1),l-=1;else if(".."===f){if(1===l&&(".."===e[2]||".."===e[0]))break;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||g)&&h){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),p)for(d=p.length;d>0;d-=1)if(i=h[p.slice(0,d).join("/")],i&&(i=i[r])){o=i,s=l;break}if(o)break;!u&&g&&g[r]&&(u=g[r],c=l)}!o&&u&&(o=u,s=c),o&&(n.splice(0,s,o),e=n.join("/"))}return e}function a(t,n){return function(){var r=_.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),p.apply(e,r.concat([t,n]))}}function s(e){return function(t){return o(t,e)}}function u(e){return function(t){m[e]=t}}function c(t){if(i(v,t)){var n=v[t];delete v[t],b[t]=!0,f.apply(e,n)}if(!i(m,t)&&!i(b,t))throw new Error("No "+t);return m[t]}function l(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return y&&y.config&&y.config[e]||{}}}var f,p,h,g,m={},v={},y={},b={},w=Object.prototype.hasOwnProperty,_=[].slice,E=/\.js$/;h=function(e,t){var n,r=l(e),i=r[0];return e=r[1],i&&(i=o(i,t),n=c(i)),i?e=n&&n.normalize?n.normalize(e,s(t)):o(e,t):(e=o(e,t),r=l(e),i=r[0],e=r[1],i&&(n=c(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},g={require:function(e){return a(e)},exports:function(e){var t=m[e];return"undefined"!=typeof t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:d(e)}}},f=function(t,n,r,o){var s,l,d,f,p,y,w=[],_=typeof r;if(o=o||t,"undefined"===_||"function"===_){for(n=!n.length&&r.length?["require","exports","module"]:n,p=0;p<n.length;p+=1)if(f=h(n[p],o),l=f.f,"require"===l)w[p]=g.require(t);else if("exports"===l)w[p]=g.exports(t),y=!0;else if("module"===l)s=w[p]=g.module(t);else if(i(m,l)||i(v,l)||i(b,l))w[p]=c(l);else{if(!f.p)throw new Error(t+" missing "+l);f.p.load(f.n,a(o,!0),u(l),{}),w[p]=m[l]}d=r?r.apply(m[t],w):void 0,t&&(s&&s.exports!==e&&s.exports!==m[t]?m[t]=s.exports:d===e&&y||(m[t]=d))}else t&&(m[t]=r)},t=n=p=function(t,n,r,i,o){if("string"==typeof t)return g[t]?g[t](n):c(h(t,n).f);if(!t.splice){if(y=t,y.deps&&p(y.deps,y.callback),!n)return;n.splice?(t=n,n=r,r=null):t=e}return n=n||function(){},"function"==typeof r&&(r=i,i=o),i?f(e,t,n,r):setTimeout(function(){f(e,t,n,r)},4),p},p.config=function(e){return p(e)},t._defined=m,r=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),i(m,e)||i(v,e)||(v[e]=[e,t,n])},r.amd={jQuery:!0}}(),r("almond",function(){}),e.generate=function(){var t=e._gri,n=e._ha;return n(t(32),8)+"-"+n(t(16),4)+"-"+n(16384|t(12),4)+"-"+n(32768|t(14),4)+"-"+n(t(48),12)},e._gri=function(e){return 0>e?NaN:30>=e?0|Math.random()*(1<<e):53>=e?(0|1073741824*Math.random())+1073741824*(0|Math.random()*(1<<e-30)):NaN},e._ha=function(e,t){for(var n=e.toString(16),r=t-n.length,i="0";r>0;r>>>=1,i+=i)1&r&&(n=i+n);return n},r("UUID",function(){}),function(e){var t,n,r,i={}.toString;Kamino={},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Kamino),exports.Kamino=Kamino):e.Kamino=Kamino,Kamino.VERSION="0.1.0",KaminoException=function(){this.name="KaminoException",this.number=25,this.message="Uncaught Error: DATA_CLONE_ERR: Kamino Exception 25"};var o=new Date(-0xc782b5b800cec);try{o=-109252==o.getUTCFullYear()&&0===o.getUTCMonth()&&1==o.getUTCDate()&&10==o.getUTCHours()&&37==o.getUTCMinutes()&&6==o.getUTCSeconds()&&708==o.getUTCMilliseconds()}catch(a){}var s="A"!="A"[0];if(!o){Math.floor}(t={}.hasOwnProperty)||(t=function(e){var n,r={};return(r.__proto__=null,r.__proto__={toString:1},r).toString!=i?t=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(n=r.constructor,t=function(e){var t=(this.constructor||n).prototype;return e in this&&!(e in t&&this[e]===t[e])}),r=null,t.call(this,e)}),n=function(e,n){var r,o,a,s,u=0;(r=function(){this.valueOf=0}).prototype.valueOf=0,o=new r;for(a in o)t.call(o,a)&&u++;return r=o=null,u?s=2==u?function(e,n){var r,o={},a="[object Function]"==i.call(e);for(r in e)a&&"prototype"==r||t.call(o,r)||!(o[r]=1)||!t.call(e,r)||n(r)}:function(e,n){var r,o,a="[object Function]"==i.call(e);for(r in e)a&&"prototype"==r||!t.call(e,r)||(o="constructor"===r)||n(r);(o||t.call(e,r="constructor"))&&n(r)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],s=function(e,n){var r,a,s="[object Function]"==i.call(e);for(r in e)s&&"prototype"==r||!t.call(e,r)||n(r);for(a=o.length;r=o[--a];t.call(e,r)&&n(r));}),s(e,n)};var u={"\\":"\\\\",'"':'\\"',"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},c=function(e,t){return("000000"+(t||0)).slice(-e)},l=function(e){for(var t,n='"',r=0;t=e.charAt(r);r++)n+='\\"\b\f\n\r	'.indexOf(t)>-1?u[t]:u[t]=" ">t?"\\u00"+c(2,t.charCodeAt(0).toString(16)):t;return n+'"'},d=function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},f=function(e,o,a,u,c,p,h){var g,m,v,y,b,w,_,E,x,C,I=o[e],A="";if(I instanceof Error||I instanceof Function)throw new KaminoException;if(d(I))throw new KaminoException;if("object"==typeof I&&I&&(g=i.call(I),"[object Date]"!=g||t.call(I,"toJSON")?"function"==typeof I.toJSON&&("[object Number]"!=g&&"[object String]"!=g&&"[object Array]"!=g||t.call(I,"toJSON"))&&(I=I.toJSON(e)):I=I>-1/0&&1/0>I?I.toUTCString().replace("GMT","UTC"):null),a&&(I=a.call(o,e,I)),null===I)return"null";if(void 0===I)return void 0;if(m=i.call(I),"[object Boolean]"==m)return""+I;if("[object Number]"==m)return I===Number.POSITIVE_INFINITY?"Infinity":I===Number.NEGATIVE_INFINITY?"NInfinity":isNaN(I)?"NaN":""+I;if("[object RegExp]"==m)return C=I.source,A+=I.ignoreCase?"i":"",A+=I.global?"g":"",A+=I.multiline?"m":"",C=l(s?C.split(""):C),A=l(s?A.split(""):A),I="^"+C+A;if("[object String]"==m)return I=l(s?I.split(""):I),"[object Date]"==g&&(I="%"+I),I;if("object"==typeof I){for(w=h.length;w--;)if(h[w]===I)return"&"+w;if(h.push(I),v=[],_=p,p+=c,"[object Array]"==m){for(b=0,w=I.length;w>b;E||(E=!0),b++)y=f(b,I,a,u,c,p,h),v.push(y===r?"null":y);x=E?c?"[\n"+p+v.join(",\n"+p)+"\n"+_+"]":"["+v.join(",")+"]":"[]"}else n(u||I,function(e){var t=f(e,I,a,u,c,p,h);t!==r&&v.push(l(s?e.split(""):e)+":"+(c?" ":"")+t),E||(E=!0)}),x=E?c?"{\n"+p+v.join(",\n"+p)+"\n"+_+"}":"{"+v.join(",")+"}":"{}";return x}};Kamino.stringify=function(e,t,n){var r,o,a;if("function"==typeof t||"object"==typeof t&&t)if("[object Function]"==i.call(t))o=t;else if("[object Array]"==i.call(t)){a={};for(var s,u=0,c=t.length;c>u;s=t[u++],("[object String]"==i.call(s)||"[object Number]"==i.call(s))&&(a[s]=1));}if(n)if("[object Number]"==i.call(n)){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==i.call(n)&&(r=n.length<=10?n:n.slice(0,10));return f("",(s={},s[""]=e,s),o,a,r,"",[])};var p,h,g,m=String.fromCharCode,v={"\\":"\\",'"':'"',"/":"/",b:"\b",t:"	",n:"\n",f:"\f",r:"\r"},y=function(){throw p=h=null,SyntaxError()},b=function(e){e=e||"";var t,n,r,i,o=h,a=o.length;for(t=e,p++;a>p;)if(n=o[p]," ">n)y();else if("\\"==n)if(n=o[++p],'\\"/btnfr'.indexOf(n)>-1)t+=v[n],p++;else if("u"==n){for(r=++p,i=p+4;i>p;p++)n=o[p],n>="0"&&"9">=n||n>="a"&&"f">=n||n>="A"&&"F">=n||y();t+=m("0x"+o.slice(r,p))}else y();else{if('"'==n)break;t+=n,p++}return'"'==o[p]?(p++,t):void y()},w=function(){for(var e,t,n,r,i,o,a,s=h,u=s.length;u>p;)if(e=s[p],"	\r\n ".indexOf(e)>-1)p++;else{if("{}[]:,".indexOf(e)>-1)return p++,e;if('"'==e)return b("@");if("%"==e){if(p++,e=s[p],'"'==e)return i=b(),new Date(i);y()}else if("^"==e){if(p++,e=s[p],'"'==e&&(o=b(),e=s[p],'"'==e))return a=b(),new RegExp(o,a);y()}else if("&"==e){if(p++,e=s[p],e>="0"&&"9">=e)return p++,g[e];y()}else{if(t=p,"-"==e&&(r=!0,e=s[++p]),e>="0"&&"9">=e){for("0"==e&&(e=s[p+1],e>="0"&&"9">=e)&&y(),r=!1;u>p&&(e=s[p],e>="0"&&"9">=e);p++);if("."==s[p]){for(n=++p;u>n&&(e=s[n],e>="0"&&"9">=e);n++);n==p&&y(),p=n}if(e=s[p],"e"==e||"E"==e){for(e=s[++p],("+"==e||"-"==e)&&p++,n=p;u>n&&(e=s[n],e>="0"&&"9">=e);n++);n==p&&y(),p=n}return+s.slice(t,p)}if(r&&y(),"true"==s.slice(p,p+4))return p+=4,!0;if("false"==s.slice(p,p+5))return p+=5,!1;if("Infinity"==s.slice(p,p+8))return p+=8,1/0;if("NInfinity"==s.slice(p,p+9))return p+=9,-(1/0);if("NaN"==s.slice(p,p+3))return p+=3,NaN;if("null"==s.slice(p,p+4))return p+=4,null;y()}}return"$"},_=function(e){var t,n;if("$"==e&&y(),"string"==typeof e){if("@"==e[0])return e.slice(1);if("["==e){for(t=[],g[g.length]=t;e=w(),"]"!=e;n||(n=!0))n&&(","==e?(e=w(),"]"==e&&y()):y()),","==e&&y(),t.push(_("string"==typeof e&&s?e.split(""):e));return t}if("{"==e){for(t={},g[g.length]=t;e=w(),"}"!=e;n||(n=!0)){n&&(","==e?(e=w(),"}"==e&&y()):y()),(","==e||"string"!=typeof e||"@"!=e[0]||":"!=w())&&y();var r=w();t[e.slice(1)]=_("string"==typeof r&&s?r.split(""):r)}return t}y()}return e},E=function(e,t,n){var i=x(e,t,n);i===r?delete e[t]:e[t]=i},x=function(e,t,r){var o,a=e[t];if("object"==typeof a&&a)if("[object Array]"==i.call(a))for(o=a.length;o--;)E(a,o,r);else n(a,function(e){E(a,e,r)});return r.call(e,t,a)};Kamino.parse=function(e,t){var n,r;return p=0,h=""+e,g=[],s&&(h=e.split("")),n=_(w()),"$"!=w()&&y(),p=h=null,t&&"[object Function]"==i.call(t)?x((r={},r[""]=n,r),"",t):n},Kamino.clone=function(e){return Kamino.parse(Kamino.stringify(e))}}(this),r("kamino",function(){}),function(t){function n(e){return e&&"[object Function]"===Object.prototype.toString.call(e)}function r(){return"undefined"==typeof Worker&&"undefined"==typeof o}var i=t,o=i.Window,a=!1,s=[].slice;if(a||!i.MessageChannel){var u=function(e){return"undefined"!=typeof window&&i instanceof o&&(!n(i.Worker)||!(e instanceof Worker))},c=function(e){if(f.verbose){var t=s.apply(arguments);t.unshift("MCNP: "),console.log.apply(console,t)}},l={},d=i.MessagePort=function(t){this._entangledPortUuid=null,this.destinationUrl=null,this._listeners={},this._messageQueue=[],this._messageQueueEnabled=!1,this._currentTarget=null,this.uuid=t||e.generate(),l[this.uuid]=this,this.log("created")};d.prototype={start:function(){var e,t=this;setTimeout(function(){for(t.log("draining "+t._messageQueue.length+" queued messages");t._messageQueueEnabled&&(e=t._messageQueue.shift());)t.dispatchEvent(e)}),this._messageQueueEnabled=!0,this.log("started")},close:function(){this._messageQueueEnabled=!1,this._entangledPortUuid&&(this._getEntangledPort()._entangledPortUuid=null,this._entangledPortUuid=null)},postMessage:function(e){var t,n=this._getEntangledPort(),r=this._currentTarget;return n?void(r?(t=f.encodeEvent(e,[n],!0),u(r)?(this.log("posting message from window to window",e,this.destinationUrl),r.postMessage(t,this.destinationUrl)):(this.log("posting message from or to worker",e),r.postMessage(t))):(this.log("not connected, queueing message",e),n._enqueueEvent(f._messageEvent(e,[n],!0)))):void this.log("not entangled, discarding message",e)},addEventListener:function(e,t){"undefined"==typeof this._listeners[e]&&(this._listeners[e]=[]),this._listeners[e].push(t)},removeEventListener:function(e,t){if(this._listeners[e]instanceof Array)for(var n=this._listeners[e],r=0;r<n.length;r++)if(n[r]===t){n.splice(r,1);break}},dispatchEvent:function(e){var t=this._listeners.message;if(t)for(var n=0;n<t.length;n++)t[n].call(this,e)},_enqueueEvent:function(e){this._messageQueueEnabled?this.dispatchEvent(e):this._messageQueue.push(e)},_getPort:function(e,t,n){var r=function(e){var t=l[e]||f._createPort(e);return t},o=r(e.uuid);if(o._entangledPortUuid=e._entangledPortUuid,o._getEntangledPort()._entangledPortUuid=o.uuid,o._currentTarget=t.source||t.currentTarget||i,"null"===t.origin?o.destinationUrl="*":o.destinationUrl=t.origin,n)for(var a=0;a<e._messageQueue.length;a++)o._messageQueue.push(e._messageQueue[a]);return o},_getEntangledPort:function(){return this._entangledPortUuid?l[this._entangledPortUuid]||f._createPort(this._entangledPortUuid):null},log:function(){if(f.verbose){var e=s.apply(arguments);e.unshift("Port",this.uuid),c.apply(null,e)}}};var f=i.MessageChannel=function(){var e,t=f._createPort(),n=f._createPort();return t._entangledPortUuid=n.uuid,n._entangledPortUuid=t.uuid,e={port1:t,port2:n},f.log(e,"created"),e};f.log=function(e){if(f.verbose){var t=["Chnl"],n=s.call(arguments,1);e.port1&&e.port2?t.push(e.port1.uuid,e.port2.uuid):e.forEach(function(e){t.push(e._entangledPortUuid)}),t.push.apply(t,n),c.apply(null,t)}},f._createPort=function(){var e=arguments,t=function(){return d.apply(this,e)};return t.prototype=d.prototype,new t},f.encodeEvent=function(e,t,n){for(var r,i,o=new Array(t.length),a=0;a<t.length;++a)o[a]=f._strippedPort(t[a]);return i={event:f._messageEvent(e,o,n)},r=Kamino.stringify(i)},f._messageEvent=function(e,t,n){return{data:e,ports:t,messageChannel:n}},f._strippedPort=function(e){if(e){for(var t,n,r,i=[],o=0;o<e._messageQueue.length;++o){t=e._messageQueue[o],n=t.ports||[],r=[];for(var a,s=0;s<n.length;++s)a=n[s],r.push({uuid:a.uuid,_entangledPortUuid:a._entangledPortUuid});i.push({data:t.data,messageChannel:t.messageChannel,ports:r})}return{uuid:e.uuid,_entangledPortUuid:e._entangledPortUuid,_messageQueue:i}}},f.decodeEvent=function(e,t){var n={data:null,ports:[]},r=Kamino.parse(e.data),i=r.event,o=i.ports;if(i){if(o)for(var a=0;a<o.length;a++)n.ports.push(d.prototype._getPort(o[a],e,t));n.data=i.data,n.source=e.source,n.messageChannel=i.messageChannel}return n};var p=function(e,t){var n;try{n=f.decodeEvent(e,t)}catch(r){if(!(r instanceof SyntaxError))throw r;n=e}return n},h=function(e){var t=p(e,!0);t.messageChannel&&f.propagateEvent(t)},g=function(e){e.addEventListener?e.addEventListener("message",h,!1):e.attachEvent&&e.attachEvent("onmessage",h)},m=function(e){var t,n,r,i,o;e.addEventListener?(n="addEventListener",i="removeEventListener",o="message"):e.attachEvent&&(n="attachEvent",i="detachEvent",o="onmessage"),t=e[n],r=e[i],e[n]=function(){var e,n=Array.prototype.slice.call(arguments),r=n[1],i=this;n[0]===o&&(e=function(e){var t=p(e);t.messageChannel||r.call(i,t)},r.messageHandlerWrapper=e,n[1]=e),t.apply(this,n)},e[i]=function(){var e=Array.prototype.slice.call(arguments),t=e[1];e[0]===o&&(e[1]=t.messageHandlerWrapper,delete t.messageHandlerWrapper),e[1]&&r.apply(this,e)}};if(f.propagateEvent=function(e){var t,n,r;if(e.messageChannel){t=e.ports;for(var i=0;i<t.length;i++)n=t[i],r=n._getEntangledPort(),n._currentTarget&&r._currentTarget?r.postMessage(e.data):n._enqueueEvent(e)}},f.reset=function(){l={}},g(i),o){o.postMessage=function(e,t,n,r){var i,o;if(r=r||[],i=f.encodeEvent(t,r,!1),r)for(var a=0;a<r.length;a++)o=r[a]._getEntangledPort(),o._currentTarget||(o._currentTarget=e,o.destinationUrl=n);f.log(r,"handshake window",e),e.postMessage(i,n)};var v;if(window.addEventListener)v=window;else{if(!window.attachEvent)throw"We couldn't find a method to attach an event handler.";v=o.prototype}m(v)}else m(i);if(i.Worker){var y,b=Worker;b.prototype.addEventListener?y=b.prototype.addEventListener:b.prototype.attachEvent&&(y=b.prototype.attachEvent),i.Worker=function(){var e=new b(arguments[0]),t=y;return t.call(e,"message",h),e},Worker.prototype=b.prototype,m(Worker.prototype)}else r()&&(i.Worker={});i.Worker&&(i.Worker.postMessage=function(e,t,n){for(var r,i=f.encodeEvent(t,n,!1),o=0;o<n.length;o++)r=n[o]._getEntangledPort(),r._currentTarget=e;f.log(n,"handshake worker",e),e.postMessage(i)})}else o?o.postMessage=function(e,t,n,r){r=r||[],e.postMessage(t,n,r)}:i.Worker={postMessage:function(e,t,n){e.postMessage(t,n)}},i.Worker&&(i.Worker.postMessage=function(e,t,n){e.postMessage(t,n)})}(this),r("MessageChannel",function(){}),r("glympse-adapter/lib/utils",["require","exports","module"],function(e,t,n){var r="__gacfg",i={dbg:function(e,t){return function(n,r,i){(!t||t>=0&&i>=t)&&console.log("["+e+"] "+n+(void 0!==r&&": "+JSON.stringify(r,null,"  ")||""))}},domain:window.location.hostname,getCookie:function(e){var t,n,r,i,o,a=document.cookie.split(";");for(n=0;n<a.length;n++)if(t=a[n],r=t.indexOf("="),i=t.substr(0,r),o=t.substr(r+1),i.replace(/^\s+|\s+$/g,"")===e)return window.unescape(o);return null},setCookie:function(e,t,n){var r=new Date;r.setTime(r.getTime()+24*(n||365)*3600*1e3),document.cookie=e+"="+(t+"; expires="+r.toGMTString()+"; domain="+i.domain+"; path=/")},getCfgVal:function(e,t){var n=i.getCookie(t||r);return n?JSON.parse(n)[e]:null},setCfgVal:function(e,t,n){var o=n||r,a=i.getCookie(o);a=a?JSON.parse(a):{},a[e]=t,i.setCookie(o,JSON.stringify(a))},capFirst:function(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)},toUpperCamel:function(e){for(var t=e&&e.split("_")||"",n="",r=0,o=t.length;o>r;r++)n+=i.capFirst(t[r]);return n},mapProps:function(e,t,n){function r(e){return function(){return n&&n[e]}}for(var o=0,a=t.length;a>o;o++){var s=t[o];e["get"+i.toUpperCamel(s)]=r(s)}},simplifyInvite:function(e){return e&&e.toLowerCase().split("-").join("")||""},normalizeInvite:function(e){if(e){e=e.toUpperCase();var t=e.length,n=t/2;(6===t||8===t)&&(e=e.substr(0,n)+"-"+e.substr(n,n))}return e},cleanInvites:function(e){e=e||[];for(var t=0,n=e.length;n>t;t++)e[t]=i.normalizeInvite(e[t]);return e}};n.exports=i}),function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(){}function a(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}function s(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}function u(e,t){return"onerror"===e?void xe.on("error",t):2!==arguments.length?xe[e]:void(xe[e]=t)}function c(){setTimeout(function(){for(var e,t=0;t<Ce.length;t++){e=Ce[t];var n=e.payload;n.guid=n.key+n.id,n.childGuid=n.key+n.childId,n.error&&(n.stack=n.error.stack),xe.trigger(e.name,e.payload)}Ce.length=0},50)}function l(e,t,n){1===Ce.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:n&&n._id,label:t._label,timeStamp:we(),error:xe["instrument-with-stack"]?new Error(t._label):null}})&&c()}function d(){return new TypeError("A promises callback cannot return that same promise.")}function f(){}function p(e){try{return e.then}catch(t){return Pe.error=t,Pe}}function h(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function g(e,t,n){xe.async(function(e){var r=!1,i=h(n,t,function(n){r||(r=!0,t!==n?y(e,n):w(e,n))},function(t){r||(r=!0,_(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,_(e,i))},e)}function m(e,t){t._state===Se?w(e,t._result):t._state===Te?(t._onError=null,_(e,t._result)):E(t,void 0,function(n){t!==n?y(e,n):w(e,n)},function(t){_(e,t)})}function v(e,n){if(n.constructor===e.constructor)m(e,n);else{var r=p(n);r===Pe?_(e,Pe.error):void 0===r?w(e,n):t(r)?g(e,n,r):w(e,n)}}function y(t,n){t===n?w(t,n):e(n)?v(t,n):w(t,n)}function b(e){e._onError&&e._onError(e._result),x(e)}function w(e,t){e._state===Ae&&(e._result=t,e._state=Se,0===e._subscribers.length?xe.instrument&&Ie("fulfilled",e):xe.async(x,e))}function _(e,t){e._state===Ae&&(e._state=Te,e._result=t,xe.async(b,e))}function E(e,t,n,r){var i=e._subscribers,o=i.length;e._onError=null,i[o]=t,i[o+Se]=n,i[o+Te]=r,0===o&&e._state&&xe.async(x,e)}function x(e){var t=e._subscribers,n=e._state;if(xe.instrument&&Ie(n===Se?"fulfilled":"rejected",e),0!==t.length){for(var r,i,o=e._result,a=0;a<t.length;a+=3)r=t[a],i=t[a+n],r?A(n,r,i,o):i(o);e._subscribers.length=0}}function C(){this.error=null}function I(e,t){try{return e(t)}catch(n){return Me.error=n,Me}}function A(e,n,r,i){var o,a,s,u,c=t(r);if(c){if(o=I(r,i),o===Me?(u=!0,a=o.error,o=null):s=!0,n===o)return void _(n,d())}else o=i,s=!0;n._state!==Ae||(c&&s?y(n,o):u?_(n,a):e===Se?w(n,o):e===Te&&_(n,o))}function S(e,t){var n=!1;try{t(function(t){n||(n=!0,y(e,t))},function(t){n||(n=!0,_(e,t))})}catch(r){_(e,r)}}function T(e,t,n){return e===Se?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function P(e,t,n,r){this._instanceConstructor=e,this.promise=new e(f,r),this._abortOnReject=n,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&w(this.promise,this._result))):_(this.promise,this._validationError())}function M(e,t){return new ke(this,e,!0,t).promise}function k(e,t){function n(e){y(o,e)}function r(e){_(o,e)}var i=this,o=new i(f,t);if(!be(e))return _(o,new TypeError("You must pass an array to race.")),o;for(var a=e.length,s=0;o._state===Ae&&a>s;s++)E(i.resolve(e[s]),void 0,n,r);return o}function O(e,t){var n=this;if(e&&"object"==typeof e&&e.constructor===n)return e;var r=new n(f,t);return y(r,e),r}function D(e,t){var n=this,r=new n(f,t);return _(r,e),r}function R(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function L(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function j(e,n){this._id=Ne++,this._label=n,this._state=void 0,this._result=void 0,this._subscribers=[],xe.instrument&&Ie("created",this),f!==e&&(t(e)||R(),this instanceof j||L(),S(this,e))}function N(e,t,n){this._superConstructor(e,t,!1,n)}function U(e,t){return new N(Ue,e,t).promise}function q(e,t){return Ue.all(e,t)}function z(e,t){$e[He]=e,$e[He+1]=t,He+=2,2===He&&ze()}function G(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&"0"===t[1]&&"10"===t[2]&&(e=setImmediate),function(){e(Q)}}function V(){return function(){qe(Q)}}function H(){var e=0,t=new Ke(Q),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function W(){var e=new MessageChannel;return e.port1.onmessage=Q,function(){e.port2.postMessage(0)}}function F(){return function(){setTimeout(Q,1)}}function Q(){for(var e=0;He>e;e+=2){var t=$e[e],n=$e[e+1];t(n),$e[e]=void 0,$e[e+1]=void 0}He=0}function K(){try{var e=n,t=e("vertx");return qe=t.runOnLoop||t.runOnContext,V()}catch(r){return F()}}function J(e){var t={};return t.promise=new Ue(function(e,n){t.resolve=e,t.reject=n},e),t}function Y(e,n,r){return Ue.all(e,r).then(function(e){if(!t(n))throw new TypeError("You must pass a function as filter's second argument.");for(var i=e.length,o=new Array(i),a=0;i>a;a++)o[a]=n(e[a]);return Ue.all(o,r).then(function(t){for(var n=new Array(i),r=0,o=0;i>o;o++)t[o]&&(n[r]=e[o],r++);return n.length=r,n})})}function $(e,t,n){this._superConstructor(e,t,!0,n)}function X(e,t,n){this._superConstructor(e,t,!1,n)}function B(e,t){return new X(Ue,e,t).promise}function Z(e,t){return new Ze(Ue,e,t).promise}function ee(e,n,r){return Ue.all(e,r).then(function(e){if(!t(n))throw new TypeError("You must pass a function as map's second argument.");for(var i=e.length,o=new Array(i),a=0;i>a;a++)o[a]=n(e[a]);return Ue.all(o,r)})}function te(){this.value=void 0}function ne(e){try{return e.then}catch(t){return rt.value=t,rt}}function re(e,t,n){try{e.apply(t,n)}catch(r){return rt.value=r,rt}}function ie(e,t){for(var n,r,i={},o=e.length,a=new Array(o),s=0;o>s;s++)a[s]=e[s];for(r=0;r<t.length;r++)n=t[r],i[n]=a[r+1];return i}function oe(e){for(var t=e.length,n=new Array(t-1),r=1;t>r;r++)n[r-1]=e[r];return n}function ae(e,t){return{then:function(n,r){return e.call(t,n,r)}}}function se(e,t){var n=function(){for(var n,r=this,i=arguments.length,o=new Array(i+1),a=!1,s=0;i>s;++s){if(n=arguments[s],!a){if(a=le(n),a===it){var u=new Ue(f);return _(u,it.value),u}a&&a!==!0&&(n=ae(a,n))}o[s]=n}var c=new Ue(f);return o[i]=function(e,n){e?_(c,e):void 0===t?y(c,n):t===!0?y(c,oe(arguments)):be(t)?y(c,ie(arguments,t)):y(c,n)},a?ce(c,o,e,r):ue(c,o,e,r)};return n.__proto__=e,n}function ue(e,t,n,r){var i=re(n,r,t);return i===rt&&_(e,i.value),e}function ce(e,t,n,r){return Ue.all(t).then(function(t){var i=re(n,r,t);return i===rt&&_(e,i.value),e})}function le(e){return e&&"object"==typeof e?e.constructor===Ue?!0:ne(e):!1}function de(e,t){return Ue.race(e,t)}function fe(e,t){return Ue.reject(e,t)}function pe(e,t){return Ue.resolve(e,t)}function he(e){throw setTimeout(function(){throw e}),e}function ge(e,t){xe.async(e,t)}function me(){xe.on.apply(xe,arguments)}function ve(){xe.off.apply(xe,arguments)}var ye;ye=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var be=ye,we=Date.now||function(){return(new Date).getTime()},_e=Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return o.prototype=e,new o},Ee={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){var n,r=s(this);n=r[e],n||(n=r[e]=[]),-1===a(n,t)&&n.push(t)},off:function(e,t){var n,r,i=s(this);return t?(n=i[e],r=a(n,t),void(-1!==r&&n.splice(r,1))):void(i[e]=[])},trigger:function(e,t){var n,r,i=s(this);if(n=i[e])for(var o=0;o<n.length;o++)(r=n[o])(t)}},xe={instrument:!1};Ee.mixin(xe);var Ce=[],Ie=l,Ae=void 0,Se=1,Te=2,Pe=new C,Me=new C,ke=P;P.prototype._validateInput=function(e){return be(e)},P.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},P.prototype._init=function(){this._result=new Array(this.length)},P.prototype._enumerate=function(){for(var e=this.length,t=this.promise,n=this._input,r=0;t._state===Ae&&e>r;r++)this._eachEntry(n[r],r)},P.prototype._eachEntry=function(e,t){var n=this._instanceConstructor;i(e)?e.constructor===n&&e._state!==Ae?(e._onError=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(n.resolve(e),t):(this._remaining--,this._result[t]=this._makeResult(Se,t,e))},P.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===Ae&&(this._remaining--,this._abortOnReject&&e===Te?_(r,n):this._result[t]=this._makeResult(e,t,n)),0===this._remaining&&w(r,this._result)},P.prototype._makeResult=function(e,t,n){return n},P.prototype._willSettleAt=function(e,t){var n=this;E(e,void 0,function(e){n._settledAt(Se,t,e)},function(e){n._settledAt(Te,t,e)})};var Oe=M,De=k,Re=O,Le=D,je="rsvp_"+we()+"-",Ne=0,Ue=j;j.cast=Re,j.all=Oe,j.race=De,j.resolve=Re,j.reject=Le,j.prototype={constructor:j,_guidKey:je,_onError:function(e){xe.async(function(t){setTimeout(function(){t._onError&&xe.trigger("error",e)},0)},this)},then:function(e,t,n){var r=this,i=r._state;if(i===Se&&!e||i===Te&&!t)return xe.instrument&&Ie("chained",this,this),this;r._onError=null;var o=new this.constructor(f,n),a=r._result;if(xe.instrument&&Ie("chained",r,o),i){var s=arguments[i-1];xe.async(function(){A(i,o,s,a)})}else E(r,o,e,t);return o},"catch":function(e,t){return this.then(null,e,t)},"finally":function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}},N.prototype=_e(ke.prototype),N.prototype._superConstructor=ke,N.prototype._makeResult=T,N.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var qe,ze,Ge=U,Ve=q,He=0,We=({}.toString,z),Fe="undefined"!=typeof window?window:void 0,Qe=Fe||{},Ke=Qe.MutationObserver||Qe.WebKitMutationObserver,Je="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Ye="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,$e=new Array(1e3);ze=Je?G():Ke?H():Ye?W():void 0===Fe&&"function"==typeof n?K():F();var Xe=J,Be=Y,Ze=$;$.prototype=_e(ke.prototype),$.prototype._superConstructor=ke,$.prototype._init=function(){this._result={}},$.prototype._validateInput=function(e){return e&&"object"==typeof e},$.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},$.prototype._enumerate=function(){var e=this.promise,t=this._input,n=[];for(var r in t)e._state===Ae&&t.hasOwnProperty(r)&&n.push({position:r,entry:t[r]});var i=n.length;this._remaining=i;for(var o,a=0;e._state===Ae&&i>a;a++)o=n[a],this._eachEntry(o.entry,o.position)},X.prototype=_e(Ze.prototype),X.prototype._superConstructor=ke,X.prototype._makeResult=T,X.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var et=B,tt=Z,nt=ee,rt=new te,it=new te,ot=se,at=de,st=fe,ut=pe,ct=he;xe.async=We;if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var lt=window.__PROMISE_INSTRUMENTATION__;u("instrument",!0);for(var dt in lt)lt.hasOwnProperty(dt)&&me(dt,lt[dt])}var ft={race:at,Promise:Ue,allSettled:Ge,hash:tt,hashSettled:et,denodeify:ot,on:me,off:ve,map:nt,filter:Be,resolve:ut,reject:st,all:Ve,rethrow:ct,defer:Xe,EventTarget:Ee,configure:u,async:ge};"function"==typeof r&&r.amd?r("rsvp",[],function(){return ft}):"undefined"!=typeof module&&module.exports?module.exports=ft:"undefined"!=typeof this&&(this.RSVP=ft)}.call(this),r("oasis/shims",["exports"],function(e){"use strict";function t(e,t){if(o.prototype=e,e=new o,t){o.prototype=e;for(var n in t)o.prototype[n]=t[n].value;e=new o}return o.prototype=null,e}function n(e,t,n){return e.addEventListener?e.addEventListener(t,n):e.attachEvent?e.attachEvent("on"+t,n):void 0}function r(e,t,n){return e.removeEventListener?e.removeEventListener(t,n):e.detachEvent?e.detachEvent("on"+t,n):void 0}function i(e){return e&&Function.prototype.toString.call(e).indexOf("[native code]")>-1}var o=function(){},a=i(Array.prototype.forEach)?Array.prototype.forEach:function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments[1],i=0;n>i;i++)i in t&&e.call(r,t[i],i,t)},s=i(Array.prototype.reduce)?Array.prototype.reduce:function(e,t){if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var n,r=0,i=this.length>>>0,o=!1;for(1<arguments.length&&(n=t,o=!0);i>r;++r)this.hasOwnProperty(r)&&(o?n=e(n,this[r],r,this):(n=this[r],o=!0));if(!o)throw new TypeError("Reduce of empty array with no initial value");return n},u=i(Array.prototype.map)?Array.prototype.map:function(e,t){var n,r,i;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),a=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(t&&(n=t),r=new Array(a),i=0;a>i;){var s,u;i in o&&(s=o[i],u=e.call(n,s,i,o),r[i]=u),i++}return r},c=i(Array.prototype.indexOf)?Array.prototype.indexOf:function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&r!=1/0&&r!=-(1/0)&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);n>i;i++)if(i in t&&t[i]===e)return i;return-1},l=i(Array.prototype.filter)?Array.prototype.filter:function(e){if(!this)throw new TypeError;var t=Object(this);t.length>>>0;if("function"!=typeof e)throw new TypeError;var n=[],r=arguments[1];for(var i in t)t.hasOwnProperty(i)&&e.call(r,t[i],i,t)&&n.push(t[i]);return n};e.o_create=t,e.addEventListener=n,e.removeEventListener=r,e.a_forEach=a,e.a_reduce=s,e.a_map=u,e.a_indexOf=c,e.a_filter=l}),r("oasis/util",["oasis/shims","exports"],function(e,t){"use strict";function n(e,t){if(!e)throw new Error(t)}function r(){}function i(e,t){return function(){throw new Error("Subclasses of "+e+" must implement "+t)}}function o(e,t){function n(){e.apply(this,arguments),
this.initialize&&this.initialize.apply(this,arguments)}n.prototype=c(e.prototype);for(var r in t)t.hasOwnProperty(r)&&(n.prototype[r]=t[r]);return n}function a(e,t){return function(){var n=this[e];return n[t].apply(n,arguments)}}function s(){var e={};return l.call(this,function(t){var n=!e.hasOwnProperty(t);return e[t]=!0,n})}function u(e,t){for(var n in t)t.hasOwnProperty(n)&&(n in e||(e[n]=t[n]));return e}var c=e.o_create,l=e.a_filter;t.assert=n,t.noop=r,t.mustImplement=i,t.extend=o,t.delegate=a,t.uniq=s,t.reverseMerge=u}),r("oasis/xhr",["oasis/util","rsvp","exports"],function(e,t,n){"use strict";function r(e){var t=e.dataType;return t&&g[t]?g[t]:g["*"]}function i(e,t){e.setRequestHeader("Accepts",r(t))}function o(e){return e.status}function a(){return 200}function s(e,t){if(t){var n=p.call(arguments,2);n.unshift(e),t.trigger.apply(t,n)}}function u(e,n,r){return!r&&this instanceof Oasis&&(r=this),n||(n=h),new t.Promise(function(t,i){var o=new c;o.open("get",e,!0),l(o,n),n.timeout&&(o.timeout=n.timeout),o.onload=function(){s("xhr.load",r,e,n,o);var a=d(o);a>=200&&300>a?t(o.responseText):i(o)},o.onprogress=f,o.ontimeout=function(){s("xhr.timeout",r,e,n,o),i(o)},o.onerror=function(){s("xhr.error",r,e,n,o),i(o)},s("xhr.send",r,e,n,o),o.send()})}var c,l,d,f=e.noop,p=Array.prototype.slice,h={},g={"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"};try{"withCredentials"in new XMLHttpRequest?(c=XMLHttpRequest,l=i,d=o):"undefined"!=typeof XDomainRequest&&(c=XDomainRequest,l=f,d=a)}catch(m){"undefined"!=typeof XDomainRequest&&(c=XDomainRequest,l=f,d=a)}n.xhr=u}),r("oasis/message_channel",["oasis/util","rsvp","exports"],function(e,t,n){"use strict";function r(e,t){}function i(e){return e.oasisId+"-"+e.requestId++}function o(e){}var a=e.extend,s=e.mustImplement;r.prototype={on:s("OasisPort","on"),all:s("OasisPort","all"),off:s("OasisPort","off"),send:s("OasisPort","send"),start:s("OasisPort","start"),close:s("OasisPort","close"),request:function(e){var n=this.oasis,r=this,o=[].slice.call(arguments,1);return new t.Promise(function(t,a){var s=i(n),u=function(){r.off("@response:"+e,c),r.off("@errorResponse:"+e,l)},c=function(e){e.requestId===s&&(u(),t(e.data))},l=function(e){e.requestId===s&&(u(),a(e.data))};r.on("@response:"+e,c,r),r.on("@errorResponse:"+e,l,r),r.send("@request:"+e,{requestId:s,args:o})})},onRequest:function(e,n,r){var i=this;this.on("@request:"+e,function(o){var a=o.requestId,s=(o.args,new t.Promise(function(t,i){var a=n.apply(r,o.args);void 0!==a?t(a):i("@request:"+e+" ["+o.requestId+"] did not return a value.  If you want to return a literal `undefined` return `RSVP.resolve(undefined)`")}));s.then(function(t){i.send("@response:"+e,{requestId:a,data:t})},function(t){var n=t;t instanceof Error&&(n={message:t.message,stack:t.stack}),i.send("@errorResponse:"+e,{requestId:a,data:n})})})}},o.prototype={start:s("OasisMessageChannel","start")};var u=a(o,{initialize:function(e){this.channel=new MessageChannel,this.port1=new c(e,this.channel.port1),this.port2=new c(e,this.channel.port2)},start:function(){this.port1.start(),this.port2.start()},destroy:function(){this.port1.close(),this.port2.close(),delete this.port1,delete this.port2,delete this.channel}}),c=a(r,{initialize:function(e,t){this.oasis=e,this.port=t,this._callbacks=[]},on:function(e,t,n){function r(r){r.data.type===e&&i.configuration.eventCallback(function(){return t.call(n,r.data.data)})}var i=this.oasis;this._callbacks.push([t,r]),this.port.addEventListener("message",r)},all:function(e,t){function n(n){r.configuration.eventCallback(function(){e.call(t,n.data.type,n.data.data)})}var r=this.oasis;this.port.addEventListener("message",n)},off:function(e,t){for(var n,r=0,i=this._callbacks.length;i>r;r++)n=this._callbacks[r],n[0]===t&&this.port.removeEventListener("message",n[1])},send:function(e,t){this.port.postMessage({type:e,data:t})},start:function(){this.port.start()},close:function(){for(var e,t=0,n=this._callbacks.length;n>t;t++)e=this._callbacks[t],this.port.removeEventListener("message",e[1]);this._callbacks=[],this.port.close()}});n.OasisPort=r,n.PostMessageMessageChannel=u,n.PostMessagePort=c}),r("oasis/logger",[],function(){"use strict";function e(){this.enabled=!1}e.prototype={enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},log:function(){if(t.enabled)if("undefined"!=typeof console&&"function"==typeof console.log)console.log.apply(console,arguments);else if("undefined"!=typeof console&&"object"==typeof console.log)try{switch(arguments.length){case 1:console.log(arguments[0]);break;case 2:console.log(arguments[0],arguments[1]);break;default:console.log(arguments[0],arguments[1],arguments[2])}}catch(e){}}};var t=new e;return t}),r("oasis/connect",["oasis/util","oasis/shims","oasis/message_channel","rsvp","oasis/logger","exports"],function(e,t,n,r,i,o){"use strict";function a(e,t,n){var o=e.ports[t];o?(i.log(e.oasisId,"sandbox: found port, setting up '"+t+"'"),n.setupCapability(o),n.promise?n.promise.then(function(){o.start()})["catch"](r.rethrow):o.start()):e.receivedPorts?(i.log("No port was sent for capability '"+t+"'"),n.rejectCapability()):(i.log("No port found, saving handler for '"+t+"'"),e.handlers[t]=n)}function s(e,t,n){return"object"==typeof e?l(this,e.consumers):t?d(this,e,t,n):f(this,e)}function u(e,t){var n=this;h.call(e,function(e,o){var a=n.handlers[e],s=new g(n,t[o]);a&&(i.log("Invoking handler for '"+e+"'"),r.resolve(a.setupCapability(s)).then(function(){s.start()})["catch"](r.rethrow)),n.ports[e]=s});for(var o in n.handlers)n.ports[o]||n.handlers[o].rejectCapability();this.receivedPorts=!0}function c(e){var t=this.ports[e];return p(t,"You asked for the port for the '"+e+"' capability, but the environment did not provide one."),t}function l(e,t){function n(t,n){return function(r){var i=new t(r);e.consumers[n]=i,i.initialize(r,n)}}function r(e){return function(){t[e].prototype.error()}}for(var i in t)a(e,i,{setupCapability:n(t[i],i),rejectCapability:r(i)})}function d(e,t,n,r){i.log("Connecting to '"+t+"' with callback."),a(e,t,{setupCapability:function(e){n(e)},rejectCapability:function(){r&&r()}})}function f(e,t){i.log("Connecting to '"+t+"' with promise.");var n=r.defer();return a(e,t,{promise:n.promise,setupCapability:function(e){return n.resolve(e),n.promise},rejectCapability:function(){n.reject()}}),n.promise}var p=e.assert,h=t.a_forEach,g=n.PostMessagePort;o.registerHandler=a,o.connect=s,o.connectCapabilities=u,o.portFor=c}),r("oasis/version",[],function(){"use strict";return"0.4.0"}),r("oasis/config",[],function(){"use strict";function e(){this.eventCallback=function(e){e()},this.allowSameOrigin=!1,this.reconnect="verify"}return e}),r("oasis/sandbox",["oasis/util","oasis/shims","oasis/message_channel","rsvp","oasis/logger"],function(e,t,n,r,i){"use strict";var o=e.assert,a=e.uniq,s=e.reverseMerge,u=t.a_forEach,c=t.a_reduce,l=(t.a_filter,n.OasisPort),d=function(e,t){t=s(t||{},{reconnect:e.configuration.reconnect});var n=t.reconnect;o("none"===n||"verify"===n||"any"===n,"`reconnect` must be one of 'none', 'verify' or 'any'.  '"+n+"' is invalid."),this.connections={},this.wiretaps=[],this.oasis=e;var r=e.packages[t.url],i=t.capabilities;i||(o(r,"You are trying to create a sandbox from an unregistered URL without providing capabilities. Please use Oasis.register to register your package or pass a list of capabilities to createSandbox."),i=r.capabilities),r=r||{},this.adapter=t.adapter||Oasis.adapters.iframe,this._capabilitiesToConnect=this._filterCapabilities(i),this.envPortDefereds={},this.sandboxPortDefereds={},this.channels={},this.capabilities={},this.options=t,this.firstLoad=!0;this.promisePorts(),this.adapter.initializeSandbox(this)};return d.prototype={waitForLoad:function(){return this._waitForLoadDeferred().promise},wiretap:function(e){this.wiretaps.push(e)},connect:function(e){var t=this.envPortDefereds[e].promise;return o(t,"Connect was called on '"+e+"' but no such capability was registered."),t},createAndTransferCapabilities:function(){this.firstLoad||this.promisePorts(),this.createChannels(),this.connectPorts(),this.firstLoad=!1},promisePorts:function(){u.call(this._capabilitiesToConnect,function(e){this.envPortDefereds[e]=r.defer(),this.sandboxPortDefereds[e]=r.defer()},this)},createChannels:function(){var e=this,t=this.options.services||{},n=this.channels;u.call(this._capabilitiesToConnect,function(r){i.log("container: Will create port for '"+r+"'");var o,a,s=t[r];if(s instanceof l)a=this.adapter.proxyPort(this,s),this.capabilities[r]=s;else{o=n[r]=this.adapter.createChannel(e.oasis);var c=this.adapter.environmentPort(this,o),d=this.adapter.sandboxPort(this,o);i.log("container: Wiretapping '"+r+"'"),c.all(function(e,t){u.call(this.wiretaps,function(n){n(r,{type:e,data:t,direction:"received"})})},this),u.call(this.wiretaps,function(e){var t=c.send;c.send=function(n,i){e(r,{type:n,data:i,direction:"sent"}),t.apply(c,arguments)}}),s&&(i.log("container: Creating service for '"+r+"'"),s=new s(c,this),s.initialize(c,r),e.oasis.services.push(s),this.capabilities[r]=s),a=d,this.envPortDefereds[r].resolve(c)}i.log("container: Port created for '"+r+"'"),this.sandboxPortDefereds[r].resolve(a)},this)},destroyChannels:function(){for(var e in this.channels)this.channels[e].destroy(),delete this.channels[e];this.channels=[]},connectPorts:function(){var e=this,t=c.call(this._capabilitiesToConnect,function(t,n){return t.concat(e.sandboxPortDefereds[n].promise)},[]);r.all(t).then(function(t){i.log("container: All "+t.length+" ports created.  Transferring them."),e.adapter.connectPorts(e,t)})["catch"](r.rethrow)},start:function(e){this.adapter.startSandbox(this,e)},terminate:function(){var e=this;if(!this.isTerminated){this.isTerminated=!0,this.adapter.terminateSandbox(this),this.destroyChannels();for(var t=0;t<e.oasis.services.length;t++)e.oasis.services[t].destroy(),delete e.oasis.services[t];e.oasis.services=[]}},onerror:function(e){throw e},name:function(){return this.adapter.name(this)},_filterCapabilities:function(e){return a.call(this.adapter.filterCapabilities(e))},_waitForLoadDeferred:function(){return this._loadDeferred||(this._loadDeferred=r.defer()),this._loadDeferred}},d}),r("oasis/sandbox_init",[],function(){"use strict";function e(){if("undefined"!=typeof window){if(/PhantomJS/.test(navigator.userAgent))return;window.parent&&window.parent!==window&&Oasis.adapters.iframe.connectSandbox(this)}else Oasis.adapters.webworker.connectSandbox(this)}return e}),r("oasis/events",[],function(){"use strict";function e(){this.listenerArrays={}}var t=Array.prototype.slice;return e.prototype={on:function(e,t){var n=this.listenerArrays[e]=this.listenerArrays[e]||[];n.push(t)},off:function(e,t){var n=this.listenerArrays[e];if(n)for(var r=0;r<n.length;++r)if(n[r]===t){n.splice(r,1);break}},clear:function(e){delete this.listenerArrays[e]},trigger:function(e){var n=this.listenerArrays[e];if(n)for(var r=t.call(arguments,1),i=0;i<n.length;++i)n[i].apply(null,r)}},e}),r("oasis/service",["oasis/shims"],function(e){"use strict";function t(e,t){function n(e){return function(){return e.apply(o,arguments)}}var r,i,o=this;this.sandbox=t,this.port=e;for(r in this.events)i=this.events[r],e.on(r,n(i));for(r in this.requests)i=this.requests[r],e.onRequest(r,n(i))}var n=e.o_create;return t.prototype={initialize:function(){},error:function(){},destroy:function(){},send:function(){return this.port.send.apply(this.port,arguments)},request:function(){return this.port.request.apply(this.port,arguments)}},t.extend=function r(e){function t(){t.prototype.init&&t.prototype.init.call(this),i.apply(this,arguments)}var i=this;t.extend=r;var o=t.prototype=n(this.prototype);for(var a in e)o[a]=e[a];return t},t}),r("oasis/base_adapter",["oasis/util","oasis/shims","oasis/connect","oasis/message_channel","rsvp","oasis/logger"],function(e,t,n,r,i,o){"use strict";function a(){this._unsupportedCapabilities=[]}var s=e.mustImplement,u=t.addEventListener,c=t.removeEventListener,l=t.a_indexOf,d=t.a_filter,f=(n.connectCapabilities,r.PostMessageMessageChannel);return a.prototype={initializeSandbox:s("BaseAdapter","initializeSandbox"),name:s("BaseAdapter","name"),unsupportedCapabilities:function(){return this._unsupportedCapabilities},addUnsupportedCapability:function(e){this._unsupportedCapabilities.push(e)},filterCapabilities:function(e){var t=this._unsupportedCapabilities;return d.call(e,function(e){var n=l.call(t,e);return-1===n})},createChannel:function(e){var t=new f(e);return t.port1.start(),t},environmentPort:function(e,t){return t.port1},sandboxPort:function(e,t){return t.port2},proxyPort:function(e,t){return t},connectSandbox:function(e,t){function n(i){i.data.isOasisInitialization&&(c(e,"message",n),r.initializeOasisSandbox(i,t))}var r=this;o.log("Sandbox listening for initialization message"),u(e,"message",n),r.oasisLoaded(t)},initializeOasisSandbox:function(e,t){var n=this;t.configuration.eventCallback(function(){o.log("sandbox: received initialization message."),t.connectCapabilities(e.data.capabilities,e.ports),n.didConnect(t)})},createInitializationMessage:function(e){return{isOasisInitialization:!0,capabilities:e._capabilitiesToConnect}},oasisLoadedMessage:"oasisSandboxLoaded",sandboxInitializedMessage:"oasisSandboxInitialized"},a}),r("oasis/iframe_adapter",["oasis/util","oasis/shims","rsvp","oasis/logger","oasis/base_adapter"],function(t,n,r,i,o){"use strict";function a(e,t){var n,r=document.createElement("iframe");if((e.configuration.allowSameOrigin&&void 0!==r.sandbox||void 0===r.sandbox)&&(n=document.createElement("a"),n.href=t,!n.host||n.protocol===window.location.protocol&&n.host===window.location.host))throw new Error("Security: iFrames from the same host cannot be sandboxed in older browsers and is disallowed.  For HTML5 browsers supporting the `sandbox` attribute on iframes, you can add the `allow-same-origin` flagonly if you host the sandbox on a separate domain.")}function s(e,t){function n(){e.onerror(new Error("Cannot reconnect null origins unless `reconnect` is set to 'any'.  `reconnect: 'verify' requires `allowSameOrigin: true`"))}var r,i;if(e.firstLoad||"any"===e.options.reconnect)return!0;if(e.oasis.configuration.allowSameOrigin&&"null"!==t.origin){if(r=document.createElement("a"),i=document.createElement("a"),r.href=e.options.url,i.href=t.origin,i.protocol===r.protocol&&i.host===r.host)return!0;n()}else n()}var u=(t.assert,t.extend),c=(n.a_forEach,n.addEventListener),l=n.removeEventListener,d=n.a_map,f=u(o,{initializeSandbox:function(t){var n=t.options,o=document.createElement("iframe"),u=["allow-scripts"];t.oasis.configuration.allowSameOrigin&&u.push("allow-same-origin"),n&&n.sandbox&&n.sandbox.popups&&u.push("allow-popups"),o.name=t.options.url+"?uuid="+e.generate(),o.sandbox=u.join(" "),o.seamless=!0,n.width?o.width=n.width:n.height&&(o.height=n.height),o.errorHandler=function(e){if(e.data.sandboxException){try{if(e.source!==o.contentWindow)return}catch(n){return}t.onerror(e.data.sandboxException)}},c(window,"message",o.errorHandler),a(t.oasis,t.options.url),o.src=t.options.url,i.log("Initializing sandbox "+o.name),t._waitForLoadDeferred().resolve(new r.Promise(function(e,n){o.initializationHandler=function(n){if(n.data===t.adapter.sandboxInitializedMessage){try{if(n.source!==o.contentWindow)return}catch(r){return}l(window,"message",o.initializationHandler),t.oasis.configuration.eventCallback(function(){i.log("container: iframe sandbox has initialized (capabilities connected)"),e(t)})}},c(window,"message",o.initializationHandler)})),t.el=o,o.oasisLoadHandler=function(e){if(e.data===t.adapter.oasisLoadedMessage){try{if(e.source!==o.contentWindow)return}catch(n){return}i.log("container: iframe sandbox has loaded Oasis"),s(t,e)&&t.createAndTransferCapabilities(),"none"===t.options.reconnect&&l(window,"message",o.oasisLoadHandler)}},c(window,"message",o.oasisLoadHandler)},startSandbox:function(e){var t=document.head||document.documentElement.getElementsByTagName("head")[0];t.appendChild(e.el)},terminateSandbox:function(e){var t=e.el;e.terminated=!0,t.loadHandler&&l(t,"load",t.loadHandler),l(window,"message",t.initializationHandler),l(window,"message",t.oasisLoadHandler),t.parentNode&&(i.log("Terminating sandbox ",e.el.name),t.parentNode.removeChild(t)),e.el=null},connectPorts:function(e,t){var n=d.call(t,function(e){return e.port}),r=this.createInitializationMessage(e);e.terminated||Window.postMessage(e.el.contentWindow,r,"*",n)},connectSandbox:function(e){return o.prototype.connectSandbox.call(this,window,e)},oasisLoaded:function(){window.parent.postMessage(this.oasisLoadedMessage,"*",[])},didConnect:function(){window.parent.postMessage(this.sandboxInitializedMessage,"*",[])},name:function(e){return e.el.name}});return f}),r("oasis/webworker_adapter",["oasis/util","oasis/shims","rsvp","oasis/logger","oasis/base_adapter"],function(t,n,r,i,o){"use strict";var a=(t.assert,t.extend),s=(n.a_forEach,n.addEventListener),u=n.removeEventListener,c=a(o,{type:"js",initializeSandbox:function(t){var n=new Worker(t.options.url);n.name=t.options.url+"?uuid="+e.generate(),t.worker=n,n.errorHandler=function(e){e.data.sandboxException&&t.onerror(e.data.sandboxException)},s(n,"message",n.errorHandler),t._waitForLoadDeferred().resolve(new r.Promise(function(e,r){n.initializationHandler=function(r){t.oasis.configuration.eventCallback(function(){r.data===t.adapter.sandboxInitializedMessage&&(u(n,"message",n.initializationHandler),i.log("worker sandbox initialized"),e(t))})},s(n,"message",n.initializationHandler)})),n.loadHandler=function(e){t.oasis.configuration.eventCallback(function(){e.data===t.adapter.oasisLoadedMessage&&(u(n,"message",n.loadHandler),i.log("worker sandbox initialized"),t.createAndTransferCapabilities())})},s(n,"message",n.loadHandler)},startSandbox:function(e){},terminateSandbox:function(e){var t=e.worker;u(t,"message",t.loadHandler),u(t,"message",t.initializationHandler),e.worker.terminate()},connectPorts:function(e,t){var n=t.map(function(e){return e.port}),r=this.createInitializationMessage(e);Worker.postMessage(e.worker,r,n)},connectSandbox:function(e){return o.prototype.connectSandbox.call(this,self,e)},name:function(e){return e.worker.name},oasisLoaded:function(){postMessage(this.oasisLoadedMessage,[])},didConnect:function(){postMessage(this.sandboxInitializedMessage,[])}});return c}),r("oasis/inline_adapter",["oasis/util","oasis/config","oasis/shims","oasis/xhr","rsvp","oasis/logger","oasis/base_adapter"],function(e,t,n,r,i,o,a){"use strict";var s=(e.assert,e.extend),u=e.noop,c=(t.configuration,n.a_forEach,n.a_map),l=r.xhr,d=s(a,{initializeSandbox:function(e){e.el=document.createElement("div");e.sandboxedOasis=new Oasis;e.sandboxedOasis.sandbox=e,i.async(function(){e.createAndTransferCapabilities()})},startSandbox:function(e){var t=document.body||document.documentElement.getElementsByTagName("body")[0];t.appendChild(e.el)},terminateSandbox:function(e){var t=e.el;t.parentNode&&(o.log("Terminating sandbox ",e.el.name),t.parentNode.removeChild(t)),e.el=null},connectPorts:function(e,t){var n=c.call(t,function(e){return e.port}),r=this.createInitializationMessage(e),i={data:r,ports:n};this.connectSandbox(e.sandboxedOasis,i)},fetchResource:function(e,t){var n=this;return l(e,{dataType:"text"},t).then(function(e){return n.wrapResource(e)})["catch"](i.rethrow)},wrapResource:function(e){return new Function("oasis",e)},connectSandbox:function(e,t){return this.initializeOasisSandbox(t,e)},oasisLoaded:u,didConnect:function(e){function t(t){return o.log("sandbox: inline sandbox initialized"),t(e),e.sandbox}function n(){return new i.Promise(function(n,i){n(r.fetchResource(e.sandbox.options.url,e).then(t))})}var r=this;return e.sandbox._waitForLoadDeferred().resolve(n()["catch"](i.rethrow))}});return d}),r("oasis",["require","exports","module","rsvp","oasis/util","oasis/xhr","oasis/connect","oasis/logger","oasis/version","oasis/config","oasis/sandbox","oasis/sandbox_init","oasis/events","oasis/service","oasis/iframe_adapter","oasis/webworker_adapter","oasis/inline_adapter"],function(e,t,n){"use strict";function r(){this.packages={},this.requestId=0,this.oasisId="oasis"+ +new Date,this.consumers={},this.services=[],this.ports={},this.handlers={},this.receivedPorts=!1,this.configuration=new l,this.events=new p,this.didCreate()}e("rsvp");var i=e("oasis/util"),o=e("oasis/xhr"),a=e("oasis/connect"),s=window.RSVP,u=e("oasis/logger"),c=e("oasis/version"),l=e("oasis/config"),d=e("oasis/sandbox"),f=e("oasis/sandbox_init"),p=e("oasis/events"),h=e("oasis/service"),g=e("oasis/iframe_adapter"),m=e("oasis/webworker_adapter"),v=e("oasis/inline_adapter"),y=i.assert,b=i.delegate,w=o.xhr,_=a.connect,E=a.connectCapabilities,x=a.portFor;r.Version=c,r.Service=r.Consumer=h,r.RSVP=s,r.reset=function(){r.adapters={iframe:new g,webworker:new m,inline:new v}},r.reset(),r.prototype={logger:u,log:function(){this.logger.log.apply(this.logger,arguments)},on:b("events","on"),off:b("events","off"),trigger:b("events","trigger"),didCreate:function(){},xhr:w,createSandbox:function(e){return new d(this,e)},register:function(e){y(e.capabilities,"You are trying to register a package without any capabilities. Please provide a list of requested capabilities, or an empty array ([])."),this.packages[e.url]=e},configure:function(e,t){this.configuration[e]=t},autoInitializeSandbox:f,connect:_,connectCapabilities:E,portFor:x},n.exports=r}),r("glympse-adapter/GlympseAdapterDefines",["require","exports","module"],function(e,t,n){"use strict";var r={MAP:{REQUESTS:{addInvites:"addInvites",addGroups:"addGroups",addMarkers:"addMarkers",addTwitterTopics:"addTwitterTopics",addTwitterUsers:"addTwitterUsers",generateRoute:"generateRoute",ignoreDestinations:"ignoreDestinations",refreshView:"refreshView",removeInvites:"removeInvites",setApiServices:"setApiServices",setPadding:"setPadding",setUserInfo:"setUserInfo",updateSetting:"updateSetting"},REQUESTS_LOCAL:{getInvites:"getInvites",getMap:"getMap"}},CARDS:{REQUESTS:{},REQUESTS_LOCAL:{}},MSG:{AdapterInit:"AdapterInit",AdapterReady:"AdapterReady",CardInit:"CardInit",CardReady:"CardReady",CardsInitEnd:"CardsInitEnd",CardsInitStart:"CardsInitStart",DataUpdate:"DataUpdate",InviteAdded:"InviteAdded",InviteInit:"InviteInit",InviteReady:"InviteReady",InviteRemoved:"InviteRemoved",Progress:"Progress",StateUpdate:"StateUpdate",ViewerInit:"ViewerInit",ViewerReady:"ViewerReady"},STATE:{Avatar:"avatar",Destination:"destination",EndTime:"end_time",Eta:"eta",Message:"message",Name:"name",Owner:"owner",Phase:"phase",Arrived:"Arrived",Expired:"Expired",NoInvites:"NoInvites"}};window.glympse||(window.glympse={}),window.glympse.GlympseAdapterDefines||(window.glympse.GlympseAdapterDefines=r),n.exports=r}),r("glympse-adapter/VersionInfo",["require","exports","module"],function(e,t,n){"use strict";n.exports={id:"glympse-adapter",version:"1.2.1",buildDate:"2015-09-06T00:09:02Z"}}),r("glympse-adapter/adapter/ViewerMonitor",["require","exports","module","glympse-adapter/GlympseAdapterDefines"],function(e,t,n){"use strict";function r(e,t){function n(t){g.removeEventListener(m.INIT,n,!1),e.notify(o.ViewerInit,!0)}function r(t){if(g.removeEventListener(m.READY,r,!1),h=t.detail.app,!h)return void d("Error getting viewer. Aborting!");for(var n=0;n<y.length;n++){var i=y[n];v.cmd(i.cmd,i.args)}e.notify(o.ViewerReady,h);var s=h.getInvites();s&&0!==s.length||e.infoUpdate(a.NoInvites,null,null,(new Date).getTime(),!0)}function i(t){var n=t.detail,r=n.id,i=n.data,s=n.owner,u=[],c=[a.Avatar,a.Destination,a.EndTime,a.Eta,a.Message,a.Name,a.Phase];b[r]||(b[r]={});for(var l=b[r],d=0,p=i.length;p>d;d++){for(var h=i[d],g=h.v,m=h.n,v=h.t,y=!1,w=0,_=c.length;_>w;w++){var E=c[w];if(m===E&&(y=!0,l[E]!==g)){l[E]=g,e.infoUpdate(E,r,s,v,g);break}}m===a.EndTime&&f(r,s),y||u.push(h)}u.length>0&&(n.data=u,e.notify(o.DataUpdate,n))}function u(t){var n=t.detail,r=(new Date).getTime();e.infoUpdate(a.Eta,n.id,n.owner,r,{eta:1e3*n.data,eta_ts:r})}function c(t){t.detail.data=void 0,e.notify(o.InviteAdded,t.detail)}function l(t){t.detail.data=void 0,e.notify(o.InviteRemoved,t.detail)}function d(e,t){console.log("[ViewerMonitor] "+e+(t?": "+JSON.stringify(t):""))}function f(t,n){p&&(clearTimeout(p),p=0);var r=(new Date).getTime(),i=b[a.EndTime];i>r&&(p=setTimeout(f,i-r)),e.infoUpdate(a.Expired,t,n,r,r>=i)}var p,h,g,m=window.glympse.events,v=this,y=[],b={};this.getViewer=function(){return h},this.run=function(){return t.viewer?(g=t.viewer,g.addEventListener(m.INIT,n,!1),g.addEventListener(m.READY,r,!1),g.addEventListener(m.DATA,i,!1),g.addEventListener(m.PROPERTIES,i,!1),g.addEventListener(m.ETA,u,!1),g.addEventListener(m.INVITE_ADDED,c,!1),void g.addEventListener(m.INVITE_REMOVED,l,!1)):void d("No viewer set. Aborting...")},this.shutdown=function(){g.removeEventListener(m.DATA,i,!1),g.removeEventListener(m.PROPERTIES,i,!1),g.removeEventListener(m.ETA,u,!1)},this.getCurrentValue=function(e){return e&&b.hasOwnProperty(e)?b[e]:'Unknown id "'+e+'"'},this.cmd=function(e,t){if(!h)return y.push({cmd:e,args:t}),null;switch(e){case s.setPadding:if(!(t instanceof Array)){if("number"!=typeof t)return"Invalid paddingArray type!";t=[null,null,null,t]}}return h[e](t)}}var i=e("glympse-adapter/GlympseAdapterDefines"),o=i.MSG,a=i.STATE,s=i.MAP.REQUESTS;n.exports=r}),r("glympse-adapter/adapter/models/Account",["require","exports","module","glympse-adapter/lib/utils"],function(e,t,n){"use strict";function r(e,t){function n(){$.getJSON(E,b).done(function(e){d(e)}).fail(function(e,t){d(null)})}function d(a){var u={status:!1};g++;try{if(a&&a.response&&"ok"===a.result)return h=a.response.access_token,i.setCfgVal(m?c:o,h),t.anon&&i.setCookie(c,h,365),u.status=!0,u.token=h,void e.notify(r.InitComplete,u)}catch(l){v("Error parsing login",l)}return s>g?void setTimeout(function(){n()},g*(500+Math.round(1e3*Math.random()))):(u.info={mode:"login",status:"max_attempts",lastResult:a&&a.result},void e.notify(r.InitComplete,u))}function f(){$.getJSON(_,b).done(function(e){p(e)}).fail(function(e,t){p(null)})}function p(t){var o={status:!1};g++;try{var a=t&&t.response;if(a&&"ok"===t.result){var c=a.id,d=a.password;return b.username=c,b.password=d,i.setCfgVal(l,c),i.setCfgVal(u,d),g=0,void n()}}catch(p){v("Error parsing create",p)}return s>g?void setTimeout(function(){f()},g*(500+Math.round(1e3*Math.random()))):(o.info={mode:"create_account",status:"max_attempts",lastResult:t&&t.result},void e.notify(r.InitComplete,o))}var h,g=0,m=t.anon,v=i.dbg("Account",t.dbg),y=t.svcGlympse||"//api.glympse.com/v2/",b={username:"viewer",password:"password"},w=t.sandbox?"eHXSnRf0slRRxGpC":"TDuy3X0PfQAyYjTt",_=y+"account/create",E=y+"account/login";b[a]=w,this.getToken=function(){return h},this.init=function(){if(!m&&(h=i.getCfgVal(o)))return!0;if(g=0,m){if(h=i.getCfgVal(c))return!0;if(h=i.getCookie(c))return i.setCfgVal(c,h),!0}else{var e=i.getCfgVal(l),t=i.getCfgVal(u);if(!e||!t)return f(),!1;b.username=e,b.password=t}return n(),!1}}var i=e("glympse-adapter/lib/utils"),o="t0",a="api_key",s=3,u="p0",c="access_token",l="n0";r.InitComplete="AccountInitComplete",n.exports=r}),r("glympse-adapter/adapter/models/MemberInvite",["require","exports","module","glympse-adapter/lib/utils"],function(e,t,n){"use strict";function r(e,t){var n=(i.dbg("MemberInvite",t.dbg),["locale","type","send","invite_code","address"]);this.getData=function(){return e},this.setData=function(t){e=t,i.mapProps(this,n,e)},this.toJSON=function(){return e},this.setData(e)}var i=e("glympse-adapter/lib/utils");n.exports=r}),r("glympse-adapter/adapter/models/MemberPermissions",["require","exports","module","glympse-adapter/lib/utils"],function(e,t,n){"use strict";function r(e,t){var n=(i.dbg("MemberTicket",t.dbg),[]);this.getData=function(){return e},this.setData=function(t){e=t,i.mapProps(this,n,e)},this.toJSON=function(){return e},this.setData(e)}var i=e("glympse-adapter/lib/utils");n.exports=r}),r("glympse-adapter/adapter/models/MemberTicket",["require","exports","module","glympse-adapter/lib/utils"],function(e,t,n){"use strict";function r(e,t){var n=(i.dbg("MemberTicket",t.dbg),["invite_code","ticket_id"]);this.getData=function(){return e},this.setData=function(t){e=t,i.mapProps(this,n,e)},this.toJSON=function(){return e},this.setData(e)}var i=e("glympse-adapter/lib/utils");n.exports=r}),r("glympse-adapter/adapter/models/Member",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/adapter/models/MemberInvite","glympse-adapter/adapter/models/MemberPermissions","glympse-adapter/adapter/models/MemberTicket"],function(e,t,n){"use strict";function r(e,t){var n,r,u,c=(i.dbg("Member",t.dbg),["status","card_id","alias","last_modified","created_time","id","user_id"]);this.getInvite=function(){return n},this.getPermissions=function(){return r},this.getTicket=function(){return u},this.getMetaData=function(){return e.metadata},this.getData=function(){return e},this.setData=function(l){e=l,i.mapProps(this,c,e),n=new o(e.invite,t),u=new s(e.ticket,t),r=new a(e.permissions,t)},this.toJSON=function(){return e},this.setData(e)}var i=e("glympse-adapter/lib/utils"),o=e("glympse-adapter/adapter/models/MemberInvite"),a=e("glympse-adapter/adapter/models/MemberPermissions"),s=e("glympse-adapter/adapter/models/MemberTicket");n.exports=r}),r("glympse-adapter/adapter/models/Card",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/adapter/models/Member","glympse-adapter/GlympseAdapterDefines"],function(e,t,n){"use strict";function r(e,t,n,r){function a(){e.notify(s.CardInit,t),$.ajax({type:"GET",dataType:"JSON",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+n)},url:m,data:v,processData:!0}).done(function(e){u(e)}).fail(function(e,t){u(null)})}function u(n){return d++,n&&n.body&&"ok"===n.result?(f=!0,p.setData(n.body),void e.notify(s.CardReady,t)):y>d?void setTimeout(function(){a()},d*(500+Math.round(1e3*Math.random()))):(h("Max attempts: ("+d+") -- "+(c&&c.result||"data=null")),void e.notify(s.CardReady,t))}var c,l,d=0,f=!1,p=this,h=i.dbg("Card",r.dbg),g=r.svcCards||"//api.cards.sandbox.glympse.com/api/v1/",m=g+"cards/invites/"+t,v={members:!0},y=3,b=["name","type_id","last_modified","created_time","id","metadata_etag"];this.getMembers=function(){return l},this.getMetaData=function(){return c.metadata},this.isLoaded=function(){return f},this.getIdCard=function(){return t},this.getData=function(){return c},this.setData=function(e){c=e,i.mapProps(this,b,c);var t=c.members;l=[];for(var n=0,a=t&&t.length||0;a>n;n++)l.push(new o(t[n],r));h('Card "'+this.getName()+'" ready with '+l.length+" members")},this.init=function(){return t&&n?(d=0,a(),!0):!1},this.toJSON=function(){return c}}var i=e("glympse-adapter/lib/utils"),o=e("glympse-adapter/adapter/models/Member"),a=e("glympse-adapter/GlympseAdapterDefines"),s=a.MSG;n.exports=r}),r("glympse-adapter/adapter/CardsController",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/GlympseAdapterDefines","glympse-adapter/adapter/models/Account","glympse-adapter/adapter/models/Card"],function(e,t,n){"use strict";function r(e,t){function n(e,n){if(!e)return void c("Error during Account.Init()",n);c("["+(t.anon?"ANON":"ACCT")+"] Authenticated. Loading "+r.length+" cards...");for(var i=0,a=r.length;a>i;i++){var s=new u(l,r[i],d.getToken(),t);s.init()?o.push(s):c("Error starting card: "+r[i])}}var r,o,c=i.dbg("CardsController",t.dbg),l=this,d=new s(this,t),f=0;this.init=function(t){o=[],r=t,f=r?r.length:0,e.notify(a.CardsInitStart,r),d.init()&&n(!0)},this.notify=function(t,r){switch(t){case s.InitComplete:n(r.status,r);break;case a.CardInit:case a.CardReady:e.notify(t,r),t===a.CardReady&&0===--f&&e.notify(a.CardsInitEnd,o);break;default:c('Unknown msg: "'+t+'"',r)}return null}}var i=e("glympse-adapter/lib/utils"),o=e("glympse-adapter/GlympseAdapterDefines"),a=o.MSG,s=(o.STATE,o.REQUESTS,e("glympse-adapter/adapter/models/Account")),u=e("glympse-adapter/adapter/models/Card");n.exports=r;
}),r("glympse-adapter/adapter/models/GlympseInvite",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/GlympseAdapterDefines"],function(e,t,n){"use strict";function r(e,t,n,r){function o(){e.notify(a.InviteInit,t),$.ajax({type:"GET",dataType:"JSON",url:f,data:y,processData:!0}).done(function(e){s(e)}).fail(function(e,t){s(null)})}function s(t){h++;try{if(t){var n=t.result;return"ok"===n?(m=!0,v.setData(t.response)):c=t.meta,void e.notify(a.InviteReady,v)}}catch(r){l("Error parsing invite",r)}return p>h?void setTimeout(function(){o()},h*(500+Math.round(1e3*Math.random()))):(c={error:"load_failure",error_detail:"Failed "+p+" attempts"},void e.notify(a.InviteReady,v))}var u,c,l=i.dbg("GlympseInvite",r.dbg),d=r.adapter.svcGlympse||"//api.sandbox.glympse.com/v2/",f=d+"invites/"+t,p=3,h=0,g=0,m=!1,v=this,y={no_count:!0,oauth_token:n,next:g},b=["first","last","next","reference","properties","type"];this.isLoaded=function(){return m},this.getIdInvite=function(){return t},this.getError=function(){return c},this.getData=function(){return u},this.setData=function(e){u=e,u.location=null,i.mapProps(this,b,u)},this.init=function(){return t&&n?(h=0,o(),!0):!1},this.toJSON=function(){return u}}var i=e("glympse-adapter/lib/utils"),o=e("glympse-adapter/GlympseAdapterDefines"),a=o.MSG;n.exports=r}),r("glympse-adapter/adapter/GlympseLoader",["require","exports","module","glympse-adapter/lib/utils","glympse-adapter/GlympseAdapterDefines","glympse-adapter/adapter/models/Account","glympse-adapter/adapter/models/GlympseInvite"],function(e,t,n){"use strict";function r(e,t){function n(e,n){return e?(c("["+(t.anon?"ANON":"ACCT")+'] Authenticated. Loading Glympse invite "'+r+'"'),o=new u(l,r,d.getToken(),t),void o.init()):void c("Error during Account.Init()",n)}var r,o,c=i.dbg("GlympseInvites",t.dbg),l=(t.svcGlympse||"//api.glympse.com/v2/",this),d=new s(this,t);this.init=function(e){r=e,d.init()&&n(!0)},this.notify=function(t,r){switch(t){case s.InitComplete:n(r.status,r);break;case a.InviteInit:case a.InviteReady:e.notify(t,r);break;default:c('Unknown msg: "'+t+'"',r)}return null}}var i=e("glympse-adapter/lib/utils"),o=e("glympse-adapter/GlympseAdapterDefines"),a=o.MSG,s=(o.STATE,o.REQUESTS,e("glympse-adapter/adapter/models/Account")),u=e("glympse-adapter/adapter/models/GlympseInvite");n.exports=r}),r("GlympseAdapter",["require","exports","module","UUID","kamino","MessageChannel","glympse-adapter/lib/utils","oasis","glympse-adapter/GlympseAdapterDefines","glympse-adapter/VersionInfo","glympse-adapter/adapter/ViewerMonitor","glympse-adapter/adapter/CardsController","glympse-adapter/adapter/GlympseLoader"],function(e,t,n){"use strict";function r(e,t){function n(e){return e&&e.split(";")}function r(e,t){return function(n){return e.cmd(t,n)||!0}}function p(e){return function(t){return e.cmd(t.id,t.args)||!0}}function h(e){console.log("processExternal: "+JSON.stringify(e))}function g(t,n,r){!r&&A.hideUpdates||r&&A.hideEvents||e.notify(t,n)}function m(){v(d.Progress,{curr:Math.min(++L,j),total:j})}function v(e,t){b(e,t),g(e,t,!0)}function y(e,t){I("**** Consumer Init **** q="+k.length),M=!0;for(var n=0,r=k.length;r>n;n++){var i=k[n];this.send(i.id,i.val)}k=[];var o=A.initialize;o&&o(t)}function b(e,t){M?P.consumers[l].send(e,t):k.push({id:e,val:t})}function w(e){I("setUserInfo",e)}function _(e){return E?E.getCurrentValue(e):"NOT_INITIALIZED"}var E,x,C,I=i.dbg("GlympseAdapter",t.dbg),A=t.adapter,S=t.viewer,T=!1,P=new o,M=!1,k=[],O=[],D=[],R={},L=0,j=0,N={};this.map={},this.cards={},this.ext={},this.getViewer=function(){return E&&E.getViewer()},this.run=function(e){if(!T){T=!0,P.autoInitializeSandbox(),R.viewer=e[0],E=new s(this,R),x=new u(this,A);var f,g,b={consumers:{}},I={setUserInfo:w},M={map:{getValue:_},cards:{}};S.services=A.svcGlympse;for(var N={invite:S.t?S.t.split(",")[0]:"???"},U=[{id:"MAP",targ:E},{id:"CARDS",targ:x}],q={ext:h},z=0,G=U.length;G>z;z++){var V=U[z],H=V.id.toLowerCase(),W=[];q[H]=p(V.targ);var F=M[H];for(f in F)this[H][f]=F[f],W.push(f);F=a[V.id].REQUESTS;for(f in F)g=r(V.targ,f),this[H][f]=g,W.push(f);F=a[V.id].REQUESTS_LOCAL;for(f in F)g=r(V.targ,f),this[H][f]=g;N[H]=W}var Q=A.interfaces;if(Q){var K=[];for(f in Q)K.push(f),this.ext[f]=Q[f];N.ext=K}k.push({id:"Connected",val:N}),b.consumers[l]=o.Consumer.extend({initialize:y,events:I,requests:q}),P.connect(b);var J=A.card,Y=A.t,$=A.pg,X=A.twt,B=A.g,Z=i.cleanInvites;O=J?Z([J]):[],D=Z(n(Y)),Y=D.join(";"),L=0,j=J?7:3,v(d.AdapterInit,{isCard:null!=J,t:D,pg:n($),twt:n(X),g:n(B)}),m(),J?x.init(O):i.simplifyInvite(Y).indexOf("demobot")<0?(C=new c(this,t),C.init(Y)):(Y||$||B||X)&&(S.t=Y,S.pg=$,S.twt=X,S.g=B,this.loadViewer(S))}},this.loadViewer=function(e){v(d.AdapterReady,{cards:O,glympses:D}),$.extend(S,e),E.run(),$(R.viewer).glympser(S)},this.notify=function(e,t){var n;switch(e){case d.CardInit:case d.CardReady:case d.CardsInitStart:case d.InviteInit:case d.ViewerInit:case d.ViewerReady:m(),v(e,t);break;case d.CardsInitEnd:v(e,t),D=[];for(var r=0,i=t,o=i.length;o>r;r++){var a=i[r];if(n=a.getIdCard(),a.isLoaded())for(var s=a.getMembers(),u=0,c=s.length;c>u;u++){var l=s[u],f=l.getTicket().getInviteCode();f&&(D.push(f),N[f]=n)}else console.log('Error loading card "'+n+'"')}D.length>0&&(S.t=D.join(";"),this.loadViewer(S));break;case d.InviteReady:if(v(e,t),!t.isLoaded())return I("Invite error state",t.getError()),null;n=t.getReference(),n?O.indexOf(n)<0&&(j+=5,O.push(n),v(d.AdapterInit,{isCard:!0}),m(),x.init(O)):(j+=2,m(),S.t=t.getIdInvite(),this.loadViewer(S));break;case d.DataUpdate:case d.InviteAdded:case d.InviteRemoved:t.card=N[t.id],v(e,t);break;default:I('notify(): unknown msg: "'+e+'"',t)}return null},this.infoUpdate=function(e,t,n,r,i){var o={id:e,invite:t,owner:n,card:N[t],t:r,val:i};g(f,o,!1),b(f,o)}}e("UUID"),e("kamino"),e("MessageChannel");var i=e("glympse-adapter/lib/utils"),o=e("oasis"),a=e("glympse-adapter/GlympseAdapterDefines"),s=(e("glympse-adapter/VersionInfo"),e("glympse-adapter/adapter/ViewerMonitor")),u=e("glympse-adapter/adapter/CardsController"),c=e("glympse-adapter/adapter/GlympseLoader"),l="glympse",d=(a.STATE,a.MSG),f=d.StateUpdate;window.Oasis||(window.Oasis=o),window.glympse||(window.glympse={}),window.glympse.GlympseAdapter||(window.glympse.GlympseAdapter=r),n.exports=r}),n(["GlympseAdapter"]),t("GlympseAdapter")});
//# sourceMappingURL=glympse-adapter-1.2.1.min.js.map